const instances=new Map;const initTokens=new Map;const normalizeSubtitleText=t=>{if(Array.isArray(t)){return t.filter(t=>typeof t==="string"&&t)}if(typeof t==="string"&&t){return[t]}return[]};const destroyInstance=t=>{const e=instances.get(t);if(e&&typeof e.destroy==="function"){try{e.destroy()}catch(t){console.error("Failed to destroy Typed instance:",t)}}instances.delete(t);const o=document.getElementById(t);if(o){o.innerHTML=""}};const createTyped=(t,e,o)=>{if(typeof window.Typed==="undefined"){return}if(!document.getElementById(t)){return}destroyInstance(t);const n=new window.Typed(`#${t}`,{strings:e,typeSpeed:o.typeSpeed,smartBackspace:o.smartBackspace,backSpeed:o.backSpeed,backDelay:o.backDelay,loop:o.loop,startDelay:o.startDelay});instances.set(t,n)};const subtitleConfig=theme?.home_banner?.subtitle||{};const hitokotoConfig=subtitleConfig.hitokoto||{};export const config={usrTypeSpeed:subtitleConfig.typing_speed,usrBackSpeed:subtitleConfig.backing_speed,usrBackDelay:subtitleConfig.backing_delay,usrStartDelay:subtitleConfig.starting_delay,usrLoop:subtitleConfig.loop,usrSmartBackspace:subtitleConfig.smart_backspace,usrHitokotoAPI:hitokotoConfig.api};export default function initTyped(s){const i=(initTokens.get(s)||0)+1;initTokens.set(s,i);const{usrTypeSpeed:t,usrBackSpeed:e,usrBackDelay:o,usrStartDelay:n,usrLoop:r,usrSmartBackspace:a,usrHitokotoAPI:c}=config;const p={typeSpeed:t??100,smartBackspace:a??false,backSpeed:e??80,backDelay:o??1500,loop:r??false,startDelay:n??500};const l=Boolean(hitokotoConfig.enable);if(l){if(!c){return}fetch(c).then(t=>t.json()).then(t=>{if(initTokens.get(s)!==i){return}const e=typeof t?.hitokoto==="string"?t.hitokoto:"";if(!e){return}const o=typeof t?.from_who==="string"&&hitokotoConfig.show_author?t.from_who:"";const n=o?`${e}——${o}`:e;createTyped(s,[n],p)}).catch(t=>{console.error("Failed to fetch hitokoto:",t)});return}const f=normalizeSubtitleText(subtitleConfig.text);if(f.length===0){return}createTyped(s,f,p)}